//==========================================================================
//文件名称：oled.c
//功能概要：OLED应用驱动程序源文件
//==========================================================================

#include "oled.h"

//当前数据/命令选择信号的电平
static uint8 current_dc_level;

//======================================================
// 128X64I液晶底层驱动[8X16]字体库
// 设计者: powerint
// 描  述: [8X16]西文字符的字模数据 (纵向取模,字节倒序)
// !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~
//======================================================
static const uint8 F8X16[] = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, // 0
		0x00, 0x00, 0x00, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x33,
		0x30, 0x00, 0x00,
		0x00, //!1
		0x00, 0x10, 0x0C, 0x06, 0x10, 0x0C, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00,
		0x00, //"2
		0x40, 0xC0, 0x78, 0x40, 0xC0, 0x78, 0x40, 0x00, 0x04, 0x3F, 0x04, 0x04,
		0x3F, 0x04, 0x04,
		0x00, //#3
		0x00, 0x70, 0x88, 0xFC, 0x08, 0x30, 0x00, 0x00, 0x00, 0x18, 0x20, 0xFF,
		0x21, 0x1E, 0x00,
		0x00, //$4
		0xF0, 0x08, 0xF0, 0x00, 0xE0, 0x18, 0x00, 0x00, 0x00, 0x21, 0x1C, 0x03,
		0x1E, 0x21, 0x1E,
		0x00, //%5
		0x00, 0xF0, 0x08, 0x88, 0x70, 0x00, 0x00, 0x00, 0x1E, 0x21, 0x23, 0x24,
		0x19, 0x27, 0x21,
		0x10, //&6
		0x10, 0x16, 0x0E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00,
		0x00, //'7
		0x00, 0x00, 0x00, 0xE0, 0x18, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x07,
		0x18, 0x20, 0x40,
		0x00, //(8
		0x00, 0x02, 0x04, 0x18, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x40, 0x20, 0x18,
		0x07, 0x00, 0x00,
		0x00, //)9
		0x40, 0x40, 0x80, 0xF0, 0x80, 0x40, 0x40, 0x00, 0x02, 0x02, 0x01, 0x0F,
		0x01, 0x02, 0x02,
		0x00, //*10
		0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x1F,
		0x01, 0x01, 0x01,
		0x00, //+11
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xB0, 0x70, 0x00,
		0x00, 0x00, 0x00,
		0x00, //,12
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01,
		0x01, 0x01, 0x01,
		0x01, //-13
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x30, 0x00,
		0x00, 0x00, 0x00,
		0x00, //.14
		0x00, 0x00, 0x00, 0x00, 0x80, 0x60, 0x18, 0x04, 0x00, 0x60, 0x18, 0x06,
		0x01, 0x00, 0x00,
		0x00, ///15
		0x00, 0xE0, 0x10, 0x08, 0x08, 0x10, 0xE0, 0x00, 0x00, 0x0F, 0x10, 0x20,
		0x20, 0x10, 0x0F,
		0x00, //016
		0x00, 0x10, 0x10, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x20, 0x3F,
		0x20, 0x20, 0x00,
		0x00, //117
		0x00, 0x70, 0x08, 0x08, 0x08, 0x88, 0x70, 0x00, 0x00, 0x30, 0x28, 0x24,
		0x22, 0x21, 0x30,
		0x00, //218
		0x00, 0x30, 0x08, 0x88, 0x88, 0x48, 0x30, 0x00, 0x00, 0x18, 0x20, 0x20,
		0x20, 0x11, 0x0E,
		0x00, //319
		0x00, 0x00, 0xC0, 0x20, 0x10, 0xF8, 0x00, 0x00, 0x00, 0x07, 0x04, 0x24,
		0x24, 0x3F, 0x24,
		0x00, //420
		0x00, 0xF8, 0x08, 0x88, 0x88, 0x08, 0x08, 0x00, 0x00, 0x19, 0x21, 0x20,
		0x20, 0x11, 0x0E,
		0x00, //521
		0x00, 0xE0, 0x10, 0x88, 0x88, 0x18, 0x00, 0x00, 0x00, 0x0F, 0x11, 0x20,
		0x20, 0x11, 0x0E,
		0x00, //622
		0x00, 0x38, 0x08, 0x08, 0xC8, 0x38, 0x08, 0x00, 0x00, 0x00, 0x00, 0x3F,
		0x00, 0x00, 0x00,
		0x00, //723
		0x00, 0x70, 0x88, 0x08, 0x08, 0x88, 0x70, 0x00, 0x00, 0x1C, 0x22, 0x21,
		0x21, 0x22, 0x1C,
		0x00, //824
		0x00, 0xE0, 0x10, 0x08, 0x08, 0x10, 0xE0, 0x00, 0x00, 0x00, 0x31, 0x22,
		0x22, 0x11, 0x0F,
		0x00, //925
		0x00, 0x00, 0x00, 0xC0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30,
		0x30, 0x00, 0x00,
		0x00, //:26
		0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x60,
		0x00, 0x00, 0x00,
		0x00, //;27
		0x00, 0x00, 0x80, 0x40, 0x20, 0x10, 0x08, 0x00, 0x00, 0x01, 0x02, 0x04,
		0x08, 0x10, 0x20,
		0x00, //<28
		0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x00, 0x04, 0x04, 0x04, 0x04,
		0x04, 0x04, 0x04,
		0x00, //=29
		0x00, 0x08, 0x10, 0x20, 0x40, 0x80, 0x00, 0x00, 0x00, 0x20, 0x10, 0x08,
		0x04, 0x02, 0x01,
		0x00, //>30
		0x00, 0x70, 0x48, 0x08, 0x08, 0x08, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x30,
		0x36, 0x01, 0x00,
		0x00, //?31
		0xC0, 0x30, 0xC8, 0x28, 0xE8, 0x10, 0xE0, 0x00, 0x07, 0x18, 0x27, 0x24,
		0x23, 0x14, 0x0B,
		0x00, //@32
		0x00, 0x00, 0xC0, 0x38, 0xE0, 0x00, 0x00, 0x00, 0x20, 0x3C, 0x23, 0x02,
		0x02, 0x27, 0x38,
		0x20, //A33
		0x08, 0xF8, 0x88, 0x88, 0x88, 0x70, 0x00, 0x00, 0x20, 0x3F, 0x20, 0x20,
		0x20, 0x11, 0x0E,
		0x00, //B34
		0xC0, 0x30, 0x08, 0x08, 0x08, 0x08, 0x38, 0x00, 0x07, 0x18, 0x20, 0x20,
		0x20, 0x10, 0x08,
		0x00, //C35
		0x08, 0xF8, 0x08, 0x08, 0x08, 0x10, 0xE0, 0x00, 0x20, 0x3F, 0x20, 0x20,
		0x20, 0x10, 0x0F,
		0x00, //D36
		0x08, 0xF8, 0x88, 0x88, 0xE8, 0x08, 0x10, 0x00, 0x20, 0x3F, 0x20, 0x20,
		0x23, 0x20, 0x18,
		0x00, //E37
		0x08, 0xF8, 0x88, 0x88, 0xE8, 0x08, 0x10, 0x00, 0x20, 0x3F, 0x20, 0x00,
		0x03, 0x00, 0x00,
		0x00, //F38
		0xC0, 0x30, 0x08, 0x08, 0x08, 0x38, 0x00, 0x00, 0x07, 0x18, 0x20, 0x20,
		0x22, 0x1E, 0x02,
		0x00, //G39
		0x08, 0xF8, 0x08, 0x00, 0x00, 0x08, 0xF8, 0x08, 0x20, 0x3F, 0x21, 0x01,
		0x01, 0x21, 0x3F,
		0x20, //H40
		0x00, 0x08, 0x08, 0xF8, 0x08, 0x08, 0x00, 0x00, 0x00, 0x20, 0x20, 0x3F,
		0x20, 0x20, 0x00,
		0x00, //I41
		0x00, 0x00, 0x08, 0x08, 0xF8, 0x08, 0x08, 0x00, 0xC0, 0x80, 0x80, 0x80,
		0x7F, 0x00, 0x00,
		0x00, //J42
		0x08, 0xF8, 0x88, 0xC0, 0x28, 0x18, 0x08, 0x00, 0x20, 0x3F, 0x20, 0x01,
		0x26, 0x38, 0x20,
		0x00, //K43
		0x08, 0xF8, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x3F, 0x20, 0x20,
		0x20, 0x20, 0x30,
		0x00, //L44
		0x08, 0xF8, 0xF8, 0x00, 0xF8, 0xF8, 0x08, 0x00, 0x20, 0x3F, 0x00, 0x3F,
		0x00, 0x3F, 0x20,
		0x00, //M45
		0x08, 0xF8, 0x30, 0xC0, 0x00, 0x08, 0xF8, 0x08, 0x20, 0x3F, 0x20, 0x00,
		0x07, 0x18, 0x3F,
		0x00, //N46
		0xE0, 0x10, 0x08, 0x08, 0x08, 0x10, 0xE0, 0x00, 0x0F, 0x10, 0x20, 0x20,
		0x20, 0x10, 0x0F,
		0x00, //O47
		0x08, 0xF8, 0x08, 0x08, 0x08, 0x08, 0xF0, 0x00, 0x20, 0x3F, 0x21, 0x01,
		0x01, 0x01, 0x00,
		0x00, //P48
		0xE0, 0x10, 0x08, 0x08, 0x08, 0x10, 0xE0, 0x00, 0x0F, 0x18, 0x24, 0x24,
		0x38, 0x50, 0x4F,
		0x00, //Q49
		0x08, 0xF8, 0x88, 0x88, 0x88, 0x88, 0x70, 0x00, 0x20, 0x3F, 0x20, 0x00,
		0x03, 0x0C, 0x30,
		0x20, //R50
		0x00, 0x70, 0x88, 0x08, 0x08, 0x08, 0x38, 0x00, 0x00, 0x38, 0x20, 0x21,
		0x21, 0x22, 0x1C,
		0x00, //S51
		0x18, 0x08, 0x08, 0xF8, 0x08, 0x08, 0x18, 0x00, 0x00, 0x00, 0x20, 0x3F,
		0x20, 0x00, 0x00,
		0x00, //T52
		0x08, 0xF8, 0x08, 0x00, 0x00, 0x08, 0xF8, 0x08, 0x00, 0x1F, 0x20, 0x20,
		0x20, 0x20, 0x1F,
		0x00, //U53
		0x08, 0x78, 0x88, 0x00, 0x00, 0xC8, 0x38, 0x08, 0x00, 0x00, 0x07, 0x38,
		0x0E, 0x01, 0x00,
		0x00, //V54
		0xF8, 0x08, 0x00, 0xF8, 0x00, 0x08, 0xF8, 0x00, 0x03, 0x3C, 0x07, 0x00,
		0x07, 0x3C, 0x03,
		0x00, //W55
		0x08, 0x18, 0x68, 0x80, 0x80, 0x68, 0x18, 0x08, 0x20, 0x30, 0x2C, 0x03,
		0x03, 0x2C, 0x30,
		0x20, //X56
		0x08, 0x38, 0xC8, 0x00, 0xC8, 0x38, 0x08, 0x00, 0x00, 0x00, 0x20, 0x3F,
		0x20, 0x00, 0x00,
		0x00, //Y57
		0x10, 0x08, 0x08, 0x08, 0xC8, 0x38, 0x08, 0x00, 0x20, 0x38, 0x26, 0x21,
		0x20, 0x20, 0x18,
		0x00, //Z58
		0x00, 0x00, 0x00, 0xFE, 0x02, 0x02, 0x02, 0x00, 0x00, 0x00, 0x00, 0x7F,
		0x40, 0x40, 0x40,
		0x00, //[59
		0x00, 0x0C, 0x30, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
		0x06, 0x38, 0xC0,
		0x00, //\60
		0x00, 0x02, 0x02, 0x02, 0xFE, 0x00, 0x00, 0x00, 0x00, 0x40, 0x40, 0x40,
		0x7F, 0x00, 0x00,
		0x00, //]61
		0x00, 0x00, 0x04, 0x02, 0x02, 0x02, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00,
		0x00, //^62
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80,
		0x80, 0x80, 0x80,
		0x80, //_63
		0x00, 0x02, 0x02, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00,
		0x00, //`64
		0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x19, 0x24, 0x22,
		0x22, 0x22, 0x3F,
		0x20, //a65
		0x08, 0xF8, 0x00, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x11, 0x20,
		0x20, 0x11, 0x0E,
		0x00, //b66
		0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x0E, 0x11, 0x20,
		0x20, 0x20, 0x11,
		0x00, //c67
		0x00, 0x00, 0x00, 0x80, 0x80, 0x88, 0xF8, 0x00, 0x00, 0x0E, 0x11, 0x20,
		0x20, 0x10, 0x3F,
		0x20, //d68
		0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x1F, 0x22, 0x22,
		0x22, 0x22, 0x13,
		0x00, //e69
		0x00, 0x80, 0x80, 0xF0, 0x88, 0x88, 0x88, 0x18, 0x00, 0x20, 0x20, 0x3F,
		0x20, 0x20, 0x00,
		0x00, //f70
		0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x6B, 0x94, 0x94,
		0x94, 0x93, 0x60,
		0x00, //g71
		0x08, 0xF8, 0x00, 0x80, 0x80, 0x80, 0x00, 0x00, 0x20, 0x3F, 0x21, 0x00,
		0x00, 0x20, 0x3F,
		0x20, //h72
		0x00, 0x80, 0x98, 0x98, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x20, 0x3F,
		0x20, 0x20, 0x00,
		0x00, //i73
		0x00, 0x00, 0x00, 0x80, 0x98, 0x98, 0x00, 0x00, 0x00, 0xC0, 0x80, 0x80,
		0x80, 0x7F, 0x00,
		0x00, //j74
		0x08, 0xF8, 0x00, 0x00, 0x80, 0x80, 0x80, 0x00, 0x20, 0x3F, 0x24, 0x02,
		0x2D, 0x30, 0x20,
		0x00, //k75
		0x00, 0x08, 0x08, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x20, 0x3F,
		0x20, 0x20, 0x00,
		0x00, //l76
		0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x20, 0x3F, 0x20, 0x00,
		0x3F, 0x20, 0x00,
		0x3F, //m77
		0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x00, 0x00, 0x20, 0x3F, 0x21, 0x00,
		0x00, 0x20, 0x3F,
		0x20, //n78
		0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x1F, 0x20, 0x20,
		0x20, 0x20, 0x1F,
		0x00, //o79
		0x80, 0x80, 0x00, 0x80, 0x80, 0x00, 0x00, 0x00, 0x80, 0xFF, 0xA1, 0x20,
		0x20, 0x11, 0x0E,
		0x00, //p80
		0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x0E, 0x11, 0x20,
		0x20, 0xA0, 0xFF,
		0x80, //q81
		0x80, 0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x00, 0x20, 0x20, 0x3F, 0x21,
		0x20, 0x00, 0x01,
		0x00, //r82
		0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x33, 0x24, 0x24,
		0x24, 0x24, 0x19,
		0x00, //s83
		0x00, 0x80, 0x80, 0xE0, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F,
		0x20, 0x20, 0x00,
		0x00, //t84
		0x80, 0x80, 0x00, 0x00, 0x00, 0x80, 0x80, 0x00, 0x00, 0x1F, 0x20, 0x20,
		0x20, 0x10, 0x3F,
		0x20, //u85
		0x80, 0x80, 0x80, 0x00, 0x00, 0x80, 0x80, 0x80, 0x00, 0x01, 0x0E, 0x30,
		0x08, 0x06, 0x01,
		0x00, //v86
		0x80, 0x80, 0x00, 0x80, 0x00, 0x80, 0x80, 0x80, 0x0F, 0x30, 0x0C, 0x03,
		0x0C, 0x30, 0x0F,
		0x00, //w87
		0x00, 0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x00, 0x00, 0x20, 0x31, 0x2E,
		0x0E, 0x31, 0x20,
		0x00, //x88
		0x80, 0x80, 0x80, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x81, 0x8E, 0x70,
		0x18, 0x06, 0x01,
		0x00, //y89
		0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x21, 0x30, 0x2C,
		0x22, 0x21, 0x30,
		0x00, //z90
		0x00, 0x00, 0x00, 0x00, 0x80, 0x7C, 0x02, 0x02, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x3F, 0x40,
		0x40, //{91
		0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0xFF, 0x00, 0x00,
		0x00, //|92
		0x00, 0x02, 0x02, 0x7C, 0x80, 0x00, 0x00, 0x00, 0x00, 0x40, 0x40, 0x3F,
		0x00, 0x00, 0x00,
		0x00, //}93
		0x00, 0x06, 0x01, 0x01, 0x02, 0x02, 0x04, 0x04, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, //~94

		};

static void oled_write_command(uint8 command) {
	//若当前不为命令信号电平
	if (current_dc_level != OLED_DC_COMMAND_LEVEL) {
		//设置为命令信号
		gpio_set(OLED_DC, OLED_DC_COMMAND_LEVEL);
		current_dc_level = OLED_DC_COMMAND_LEVEL;
	}
	//发送命令
	spi_master_send(OLED_SPI_MOD, OLED_SPI_CONFIG, OLED_SPI_CS, command,
	SPI_CONT_DISABLE);
}

static void oled_write_data(uint8 data) {
	//若当前不为数据信号电平
	if (current_dc_level != OLED_DC_DATA_LEVEL) {
		//设置为数据信号
		gpio_set(OLED_DC, OLED_DC_DATA_LEVEL);
		current_dc_level = OLED_DC_DATA_LEVEL;
	}
	//发送数据
	spi_master_send(OLED_SPI_MOD, OLED_SPI_CONFIG, OLED_SPI_CS, data,
	SPI_CONT_DISABLE);
}

//设置对比度
void oled_set_contrast(uint8 contrast) {
	//写设置对比度命令
	oled_write_command(0x81);
	//写对比度值
	oled_write_command(contrast);
}

//设置整体显示
void oled_set_entire_display(bool on) {
	if (on) {
		//整体显示
		oled_write_command(0xA5);
	} else {
		//正常显示
		oled_write_command(0xA4);
	}
}

//设置反相显示
void oled_set_inverse_display(bool on) {
	if (on) {
		//反相显示，数据0代表亮，1代表暗
		oled_write_command(0xA7);
	} else {
		//正常显示，数据0代表暗，1代表亮
		oled_write_command(0xA6);
	}
}

//设置是否打开显示
void oled_set_display_on(bool on) {
	if (on) {
		//打开显示
		oled_write_command(0xAF);
	} else {
		//关闭显示
		oled_write_command(0xAE);
	}
}

void oled_set_scroll(uint8 dir, uint8 start_page, uint8 end_page,
		uint8 interval) {
	if (dir == OLED_SCROLL_DIR_LEFT) {
		//向左水平滚屏
		oled_write_command(0x27);
	} else {
		//向右水平滚屏
		oled_write_command(0x26);
	}
	//无效字节
	oled_write_command(0x00);
	//发送起始页
	oled_write_command(start_page);
	//发送间隔频率
	oled_write_command(interval);
	//发送结束页
	oled_write_command(end_page);
	//无效字节
	oled_write_command(0x00);
	//无效字节
	oled_write_command(0xFF);
}

void oled_set_scroll_vertical_area(uint8 fixed_row_num, uint8 scroll_row_num) {
	//写设置垂直滚动区域命令
	oled_write_command(0xA3);
	//发送固定不动的行数
	oled_write_command(fixed_row_num);
	//发送垂直滚动的行数
	oled_write_command(scroll_row_num);
}

void oled_set_scroll_with_vertical(uint8 dir, uint8 start_page, uint8 end_page,
		uint8 interval, uint8 offset_row_num) {
	if (dir == OLED_SCROLL_DIR_LEFT) {
		//向左水平滚屏
		oled_write_command(0x2A);
	} else {
		//向右水平滚屏
		oled_write_command(0x29);
	}
	//无效字节
	oled_write_command(0x00);
	//发送起始页
	oled_write_command(start_page);
	//发送间隔频率
	oled_write_command(interval);
	//发送结束页
	oled_write_command(end_page);
	//发送每次垂直滚动偏移行数
	oled_write_command(offset_row_num);
}

void oled_scroll_start() {
	//写开始滚屏命令
	oled_write_command(0x2F);
}

//停止滚屏时，垂直滚动的页会回归至原先的位置，但水平滚动会停止在当前所在位置
void oled_scroll_stop() {
	//写停止滚屏命令
	oled_write_command(0x2E);
}

void OLED_Fill(uint8 bmp_data) {
	uint8 y, x;

	for (y = 0; y < 8; y++) {
		oled_write_command(0xb0 + y);
		oled_write_command(0x01);
		oled_write_command(0x10);
		for (x = 0; x < OLED_WIDTH; x++)
			oled_write_data(bmp_data);
	}
}

void OLED_Set_Pos(uint8 x, uint8 y) {
	oled_write_command(0xb0 + y);
	oled_write_command(((x & 0xf0) >> 4) | 0x10);
	oled_write_command((x & 0x0f) | 0x01);
}

void oled_init() {
	//使能复位信号，并设置复位信号有效
	gpio_init(OLED_RST, GPIO_OUTPUT, OLED_RST_VALID_LEVEL);
	//使能数据/命令选择信号，并选择命令信号
	gpio_init(OLED_DC, GPIO_OUTPUT, OLED_DC_COMMAND_LEVEL);
	//当前数据/命令选择信号的电平为命令信号电平
	current_dc_level = OLED_DC_COMMAND_LEVEL;
	//按照设置初始化SPI模块
	spi_master_init(OLED_SPI_MOD, OLED_SPI_CONFIG, OLED_SPI_BAUD_SCALER,
	OLED_SPI_FORMAT, OLED_SPI_DATA_SIZE, OLED_SPI_BIT_ORDER,
	OLED_SPI_CSC_SCALER, OLED_SPI_ASC_SCALER, OLED_SPI_DT_SCALER);

	//复位信号需要保持有效至少3μs，这里初始化DC和SPI需要8μs左右，因此未添加延时
	//设置复位信号无效
	gpio_set(OLED_RST, OLED_RST_INVALID_LEVEL);

	oled_write_command(0xAE);   //display off
	oled_write_command(0x20); //Set Memory Addressing Mode
	oled_write_command(0x10); //00,Horizontal Addressing Mode;01,Vertical Addressing Mode;10,Page Addressing Mode (RESET);11,Invalid
	oled_write_command(0xb0); //Set Page Start Address for Page Addressing Mode,0-7
	oled_write_command(0xc8); //Set COM Output Scan Direction
	oled_write_command(0x00); //---set low column address
	oled_write_command(0x10); //---set high column address
	oled_write_command(0x40); //--set start line address

	//设置对比度，两字节命令
	oled_write_command(0x81); //--set contrast control register
	oled_write_command(0x7F);

	oled_write_command(0xa1); //--set segment re-map 0 to 127
	oled_write_command(0xa6); //--set normal display
	oled_write_command(0xa8); //--set multiplex ratio(1 to 64)
	oled_write_command(0x3F); //
	oled_write_command(0xa4); //0xa4,Output follows RAM content;0xa5,Output ignores RAM content
	oled_write_command(0xd3); //-set display offset
	oled_write_command(0x00); //-not offset
	oled_write_command(0xd5); //--set display clock divide ratio/oscillator frequency
	oled_write_command(0xf0); //--set divide ratio
	oled_write_command(0xd9); //--set pre-charge period
	oled_write_command(0x22); //
	oled_write_command(0xda); //--set com pins hardware configuration
	oled_write_command(0x12);
	oled_write_command(0xdb); //--set vcomh
	oled_write_command(0x20); //0x20,0.77xVcc
	oled_write_command(0x8d); //--set DC-DC enable
	oled_write_command(0x14); //
	oled_write_command(0xaf); //--turn on oled panel

//	oled_write_command(0xae); //--turn off oled panel
//	oled_write_command(0x00); //---set low column address
//	oled_write_command(0x10); //---set high column address
//	oled_write_command(0x40); //--set start line address  Set Mapping RAM Display Start Line (0x00~0x3F)
//	oled_write_command(0x81); //--set contrast control register
//	oled_write_command(0xcf); // Set SEG Output Current Brightness
//	oled_write_command(0xa1); //--Set SEG/Column Mapping     0xa0左右反置 0xa1正常
//	oled_write_command(0xc8); //Set COM/Row Scan Direction   0xc0上下反置 0xc8正常
//	oled_write_command(0xa6); //--set normal display
//	oled_write_command(0xa8); //--set multiplex ratio(1 to 64)
//	oled_write_command(0x3f); //--1/64 duty
//	oled_write_command(0xd3); //-set display offset	Shift Mapping RAM Counter (0x00~0x3F)
//	oled_write_command(0x00); //-not offset
//	oled_write_command(0xd5); //--set display clock divide ratio/oscillator frequency
//	oled_write_command(0x80); //--set divide ratio, Set Clock as 100 Frames/Sec
//	oled_write_command(0xd9); //--set pre-charge period
//	oled_write_command(0xf1); //Set Pre-Charge as 15 Clocks & Discharge as 1 Clock
//	oled_write_command(0xda); //--set com pins hardware configuration
//	oled_write_command(0x12);
//	oled_write_command(0xdb); //--set vcomh
//	oled_write_command(0x40); //Set VCOM Deselect Level
//	oled_write_command(0x20); //-Set Page Addressing Mode (0x00/0x01/0x02)
//	oled_write_command(0x02); //
//	oled_write_command(0x8d); //--set Charge Pump enable/disable
//	oled_write_command(0x14); //--set(0x10) disable
//	oled_write_command(0xa4); // Disable Entire Display On (0xa4/0xa5)
//	oled_write_command(0xa6); // Disable Inverse Display On (0xa6/a7)
//	oled_write_command(0xaf); //--turn on oled panel
	OLED_Fill(0x00);  //初始清屏
	OLED_Set_Pos(0, 0);
}

//==============================================================
//函数名：LCD_P8x16Str(u8 x,u8 y,u8 *p)
//功能描述：写入一组标准ASCII字符串
//参数：显示的位置（x,y），y为页范围0～7，要显示的字符串
//返回：无
//==============================================================
void OLED_P8x16Str(uint8 x, uint8 y, uint8 ch[]) {
	uint8 c = 0, i = 0, j = 0;

	while (ch[j] != '\0') {
		c = ch[j] - 32;
		if (x > 120) {
			x = 0;
			y++;
		}
		OLED_Set_Pos(x, y);
		for (i = 0; i < 8; i++)
			oled_write_data(F8X16[c * 16 + i]);
		OLED_Set_Pos(x, y + 1);
		for (i = 0; i < 8; i++)
			oled_write_data(F8X16[c * 16 + i + 8]);
		x += 8;
		j++;
	}
}
